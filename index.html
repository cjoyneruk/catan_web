<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/base.css">

    <title>Ultimate Catan</title>
</head>
<body>

    <nav>
        <div class="container">
            <div class="nav-container">
                <h1>Ultimate Catan</h1>
                <ul class="nav-menu">
                    <li><a href="/" class="nav-link">Home</a></li>
                    <li><a href="/history" class="nav-link">History</a></li>
                </ul>
            </div>

        </div>
    </nav>

    <div class="container header">
        <h1>Overall leaderboard</h1>
    </div>

    <div class="container">
        <div class="card">
            <div class="card-body">
            
            <table class="base-table" id="leaderboard">
                <thead>
                    <tr>
                        <td></td>
                        <td>Player</td>
                        <td>Games played</td>
                        <td><b>Games won</b></td>
                        <td>Games lost</td>
                        <td>Total Points for</td>
                        <td>Total Points against</td>
                        <td>Win ratio</td>
                        <td>Av. Points for</td>
                        <td>Av. Points against</td>
                    </tr>
                </thead>
                <tbody>
        
                </tbody>
            </table>

            </div>

        </div>
    </div>


    <script src="js/gsheets.js"></script>

    <script>
    
    function createTd(tr, value){
        td = document.createElement('td')
        td.innerHTML = value
        tr.appendChild(td)
    }

    function createLeaderboardTable(leaderboard){

        table = document.getElementById('leaderboard')
        tbody = table.getElementsByTagName('tbody')[0]

        leaderboard.forEach((row, idx) => {

                tr = document.createElement('tr')

                createTd(tr, idx+1)
                createTd(tr, row.player)
                createTd(tr, row.played)
                createTd(tr, `<b>${row.won}</b>`)
                createTd(tr, row.lost)
                createTd(tr, row.points_for)
                createTd(tr, row.points_against)
                createTd(tr, Math.round(100*row.won/row.played)/100)
                createTd(tr, Math.round(100*row.points_for/row.played)/100)
                createTd(tr, Math.round(100*row.points_against/row.played)/100)

            tbody.appendChild(tr)
        })         
    }

    async function main(){

        const url = 'https://docs.google.com/spreadsheets/d/13lr1lbVzE-fpeGLy_X80PKPHCEXzpqUe1Yu04Q2sin8/gviz/tq?'

        data = await getSheetData(url)

        // console.log(data)

        const records = createRecords(data)
        
        let games = createGames(records)

        let leaderboard = createLeaderboard(games)
        
        createLeaderboardTable(leaderboard)

        console.log(leaderboard)

    }

    main()



    </script>

</body>
</html>